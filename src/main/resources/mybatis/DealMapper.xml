<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zeekie.stock.respository.DealMapper">

	<resultMap type="com.zeekie.stock.entity.BaseEntrustDO" id="resultEntrustInfo">
		<result column="TRADE_ACCOUNT" property="operatorNo" jdbcType="VARCHAR"/>
		<result column="ENTRUST_NO" property="entrustNo" jdbcType="VARCHAR"/>
	</resultMap>
	
	<resultMap type="com.zeekie.stock.entity.CombassetDO" id="resultCombasset">
		<result column="ACTUAL_CASH" property="assetTotalValue" typeHandler="com.zeekie.stock.handler.TwoDecimalFloatTypeHander"/>
		<result column="CURRENT_CASH" property="assetValue" typeHandler="com.zeekie.stock.handler.TwoDecimalFloatTypeHander"/>
	</resultMap>

	<insert id="insertEntrust" parameterType="com.zeekie.stock.service.homes.entity.EntrustEntity">
		<selectKey order="BEFORE" resultType="LONG" keyProperty="id">
			select SEQ_stock_entrust_id.Nextval from dual
		</selectKey>
		INSERT INTO STOCK_ENTRUST
		  (ID,
		   NICKNAME,
		   TRADE_ACCOUNT,
		   COMBINE_ID,
		   FUND_ACCOUNT,
		   ENTRUST_NO,
		   BATCH_NO,
		   STOCK_CODE,
		   EXCHANGE_TYPE,
		   ENTRUST_DIRECTION,
		   ENTRUST_PRICE,
		   ENTRUST_AMOUNT)
		VALUES
		  (#{id},
		   #{nickname},
		   #{operateNo},
		   #{combineId},
		   #{fundAccount},
		   #{entrust_no},
		   #{batch_no},
		   #{stockCode},
		   #{exchangeType},
		   #{entrustDirection},
		   #{entrustPrice},
		   #{entrustAmount}
		   )
	</insert>
	
	<select id="queryEntrustInfo" parameterType="string" resultMap="resultEntrustInfo">
		select t.TRADE_ACCOUNT,t.ENTRUST_NO from STOCK_ENTRUST t where t.nickname = #{nickname}
	</select>
	
	<select id="queryCombasset" parameterType="string" resultMap="resultCombasset">
		SELECT M.ACTUAL_CASH, M.CURRENT_CASH
		  FROM STOCK_USER_OPERATE_MAININFO M
		 WHERE M.NICKNAME = #{nickname}
	</select>
</mapper>

